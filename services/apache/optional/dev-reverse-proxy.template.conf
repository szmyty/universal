# dev-reverse-proxy.conf

# 📦 Dev-only reverse proxy to Vite dev server and HMR socket

# 🔁 HTTP: Serve Vite static app assets (HTML, JS, etc.)
<Location />
  ProxyPass "http://host.docker.internal:5173/"
  ProxyPassReverse "http://host.docker.internal:5173/"
</Location>

# 🔁 WebSocket: Vite HMR over WS (WS upgrades routed to 5174)
<IfModule mod_rewrite.c>
  RewriteEngine On
  # Match WebSocket upgrade requests at /hmr
  RewriteCond %{HTTP:Upgrade} =websocket [NC]
  RewriteRule ^/hmr/(.*)$ ws://host.docker.internal:5174/hmr/$1 [P,L]
</IfModule>

# 🔁 Optional fallback proxy for /hmr path (just in case RewriteRule fails)
<Location /hmr>
  ProxyPass "ws://host.docker.internal:5174/hmr/"
  ProxyPassReverse "ws://host.docker.internal:5174/hmr/"
</Location>
